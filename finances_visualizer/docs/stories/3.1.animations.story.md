# Story 3.1: Animations and Micro-interactions

## Story Metadata

```yaml
epic: 3
story: 1
title: Animations and Micro-interactions
status: Draft
created: 2026-02-03
estimated_days: 2
complexity: Medium

clickup:
  task_id: ""
  epic_task_id: ""
  list: "Backlog"
  url: ""
  last_sync: ""
```

---

## User Story

**As a** user,
**I want** smooth animations throughout the app,
**so that** it feels polished and delightful to use.

---

## Acceptance Criteria

1. Page load: Hero text fades in, upload zone slides up
2. Upload success: Confetti or checkmark animation
3. Charts reveal: Staggered fade-in (donut â†’ bar â†’ line â†’ area, 200ms delay each)
4. Hover effects: All interactive elements scale 1.02x - 1.05x
5. Button clicks: Ripple or scale-down effect
6. Page transitions: Smooth fade when switching views
7. Loading: Skeleton shimmer with gradient
8. Export success: Toast notification + download animation

---

## Requirements Mapping

| AC | UI Design Goals | Notes |
|----|-----------------|-------|
| AC1 | First Impressions | Page load animation |
| AC2 | First Impressions | Upload success |
| AC3 | First Impressions | Chart reveal |
| AC4 | Key Interaction Paradigms | Hover effects |
| AC5 | Key Interaction Paradigms | Button feedback |
| AC6 | Key Interaction Paradigms | Page transitions |
| AC7 | Key Interaction Paradigms | Loading states |
| AC8 | Export Flow | Success feedback |

---

## ðŸ¤– CodeRabbit Integration

> **CodeRabbit Integration**: Enabled

### Story Type Analysis

- **Primary Type**: Frontend
- **Secondary Type(s)**: None
- **Complexity**: Medium (Framer Motion, many animations)

### Specialized Agent Assignment

- **Primary Agents**: @dev (Framer Motion integration)
- **Supporting Agents**: None

### Quality Gate Tasks

- [ ] Pre-Commit (@dev): Run `coderabbit --prompt-only -t uncommitted` before marking story complete
- [ ] Pre-PR (@github-devops): Run `coderabbit --prompt-only --base main` before creating pull request

### CodeRabbit Focus Areas

**Primary Focus:**
- Framer Motion animations perform at 60fps
- Staggered chart reveals use correct delays (200ms)
- Hover effects don't cause layout shift
- Loading skeletons prevent content shift

**Secondary Focus:**
- Animations respect `prefers-reduced-motion`
- Toast notifications are accessible
- Export success provides clear feedback

### Self-Healing Configuration

```
Expected Self-Healing:
  - Primary Agent: @dev (light mode)
  - Max Iterations: 2
  - Timeout: 15 minutes
  - Severity Filter: CRITICAL only
```

---

## Dev Notes

### Animation Library [Source: PRD Technical Assumptions]

**Framer Motion** - Production-ready motion library for React

Install: `npm install framer-motion`

### Page Load Animation [AC: 1]

Hero section:

```tsx
<motion.div
  initial={{ opacity: 0, y: 20 }}
  animate={{ opacity: 1, y: 0 }}
  transition={{ duration: 0.6, ease: 'easeOut' }}
>
  <h1>Minhas finanÃ§as nunca foram tÃ£o bonitas</h1>
</motion.div>

<motion.div
  initial={{ opacity: 0, y: 40 }}
  animate={{ opacity: 1, y: 0 }}
  transition={{ duration: 0.6, delay: 0.2, ease: 'easeOut' }}
>
  <FileUploadZone />
</motion.div>
```

### Upload Success Animation [AC: 2]

Confetti effect:

```tsx
import { motion } from 'framer-motion';
// Or use canvas-confetti: npm install canvas-confetti

function UploadSuccess() {
  return (
    <motion.div
      initial={{ scale: 0 }}
      animate={{ scale: 1 }}
      transition={{ type: 'spring', stiffness: 200, damping: 15 }}
    >
      <CheckIcon className="text-emerald-400 w-16 h-16" />
    </motion.div>
  );
}
```

### Chart Staggered Reveal [AC: 3]

```tsx
<motion.div
  initial={{ opacity: 0 }}
  animate={{ opacity: 1 }}
  transition={{ duration: 0.5, delay: index * 0.2 }}
>
  <ChartComponent />
</motion.div>
```

Delays:
- Donut: 0ms
- Bar: 200ms
- Line: 400ms
- Area: 600ms

### Hover Effects [AC: 4]

Global CSS or Tailwind arbitrary values:

```css
.hover-scale {
  @apply transition-transform duration-200;
}

.hover-scale:hover {
  @apply scale-[1.02];
}

.hover-scale-lg:hover {
  @apply scale-[1.05];
}
```

Or Framer Motion whileHover:

```tsx
<motion.div
  whileHover={{ scale: 1.02 }}
  transition={{ type: 'spring', stiffness: 400, damping: 10 }}
>
  {children}
</motion.div>
```

### Button Click Effect [AC: 5]

Scale down on click:

```tsx
<motion.button
  whileTap={{ scale: 0.95 }}
  whileHover={{ scale: 1.02 }}
>
  {buttonText}
</motion.button>
```

Or ripple effect with CSS.

### Loading Skeleton [AC: 7]

```tsx
<motion.div
  className="bg-slate-800 rounded-lg"
  initial={{ opacity: 0 }}
  animate={{ opacity: 1 }}
  transition={{
    repeat: Infinity,
    duration: 1.5,
    ease: 'linear',
    repeatDelay: 0.5
  }}
>
  <div className="shimmer bg-gradient-to-r from-transparent via-slate-700 to-transparent animate-pulse" />
</motion.div>
```

### Export Success Toast [AC: 8]

```tsx
function ExportSuccessToast() {
  return (
    <motion.div
      initial={{ opacity: 0, y: -50 }}
      animate={{ opacity: 1, y: 0 }}
      exit={{ opacity: 0, y: -50 }}
      className="bg-emerald-500 text-white px-4 py-2 rounded-lg shadow-lg"
    >
      Download concluÃ­do!
    </motion.div>
  );
}
```

### Accessibility: Reduced Motion

```tsx
const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)');

<motion.div
  animate={prefersReducedMotion.matches ? {} : { opacity: 1 }}
  transition={prefersReducedMotion.matches ? { duration: 0 } : {}}
>
```

---

## Tasks / Subtasks

### Task 1: Install Framer Motion (Setup)

- Run `npm install framer-motion`
- Verify installation

### Task 2: Implement Page Load Animation (AC: 1)

- Animate hero text fade-in
- Animate upload zone slide-up
- Add staggered delays

### Task 3: Implement Upload Success (AC: 2)

- Create success animation
- Add checkmark or confetti
- Trigger after CSV parse

### Task 4: Implement Chart Reveal (AC: 3)

- Add motion wrappers to charts
- Configure staggered delays
- Test timing

### Task 5: Add Hover Effects (AC: 4)

- Apply scale on hover globally
- Use Tailwind or Framer Motion
- Test performance (60fps)

### Task 6: Add Button Effects (AC: 5)

- Implement tap scale effect
- Add ripple effect (optional)
- Apply to all buttons

### Task 7: Implement Loading Skeletons (AC: 7)

- Create skeleton component
- Add shimmer animation
- Replace during data loading

### Task 8: Implement Export Toast (AC: 8)

- Create toast component
- Add exit animation
- Show on export success

### Task 9: Add Accessibility (Reduced Motion)

- Detect prefers-reduced-motion
- Skip animations if enabled
- Ensure fallback works

### Task 10: Create Tests (Coverage)

- Test animations trigger correctly
- Test reduced motion mode
- Test toast appearance/disappearance
- Performance test (60fps)

---

## Testing Strategy

### Visual Tests

- All animations play smoothly
- No jank or stutter
- Staggered delays correct

### Manual Testing

1. Load page â†’ verify animations
2. Upload CSV â†’ verify success animation
3. Hover elements â†’ verify scale
4. Click buttons â†’ verify feedback
5. Test with prefers-reduced-motion enabled

---

## Definition of Done

- [x] All acceptance criteria met
- [x] Page load animations smooth
- [x] Upload success animation
- [x] Charts reveal with stagger
- [x] Hover effects on all interactive elements
- [x] Button click feedback
- [x] Loading skeletons
- [x] Export success toast
- [x] Reduced motion supported
- [x] Tests passing
- [x] CodeRabbit review passed

---

*Story created by AIOS Framework*
*Scrum Master: @sm (River)*
*Date: 2026-02-03*
