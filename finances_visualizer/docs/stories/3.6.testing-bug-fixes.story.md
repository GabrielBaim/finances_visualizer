# Story 3.6: Testing and Bug Fixes

## Story Metadata

```yaml
epic: 3
story: 6
title: Testing and Bug Fixes
status: Draft
created: 2026-02-03
estimated_days: 3
complexity: Medium

clickup:
  task_id: ""
  epic_task_id: ""
  list: "Backlog"
  url: ""
  last_sync: ""
```

---

## User Story

**As a** developer,
**I want** comprehensive testing before launch,
**so that** users have a smooth experience.

---

## Acceptance Criteria

1. Test with real Nubank CSV (at least 5 different users' data)
2. Test with real Inter CSV (at least 3 different users' data)
3. Test edge cases: 1 transaction, 10k transactions, future dates, negative balances
4. Test on browsers: Chrome, Firefox, Safari, Edge
5. Test on mobile: iPhone Safari, Android Chrome
6. Test export: all charts download correctly
7. Test share: links work and expire properly
8. Fix all critical bugs found during testing
9. Document known issues for v1.1

---

## Requirements Mapping

| AC | Functional Requirement | Notes |
|----|----------------------|-------|
| AC1-2 | FR2, FR3 | Real CSV data |
| AC3 | FR11 | Edge cases |
| AC4-5 | NFR1, NFR6 | Cross-browser |
| AC6 | FR8 | Export functionality |
| AC7 | FR9 | Share functionality |
| AC8 | - | Bug fixes |
| AC9 | - | Documentation |

---

## ðŸ¤– CodeRabbit Integration

> **CodeRabbit Integration**: Enabled

### Story Type Analysis

- **Primary Type**: Testing
- **Secondary Type(s)**: Frontend (bug fixes)
- **Complexity**: Medium (comprehensive testing)

### Specialized Agent Assignment

- **Primary Agents**: @dev (testing), @qa (quality validation)
- **Supporting Agents**: None

### Quality Gate Tasks

- [ ] Pre-Commit (@dev): Run `coderabbit --prompt-only -t uncommitted` before marking story complete
- [ ] Pre-PR (@github-devops): Run `coderabbit --prompt-only --base main` before creating pull request

### CodeRabbit Focus Areas

**Primary Focus:**
- Real CSV samples from Nubank/Inter parse correctly
- All chart types render with real data
- Export produces valid files (PNG/PDF)
- Share links work and expire after 24h

**Secondary Focus:**
- Edge cases handled gracefully (no crashes)
- Mobile responsive on all devices
- Cross-browser compatibility verified
- Known issues documented

### Self-Healing Configuration

```
Expected Self-Healing:
  - Primary Agent: @dev (light mode)
  - Max Iterations: 2
  - Timeout: 15 minutes
  - Severity Filter: CRITICAL only
```

---

## Dev Notes

### Test Data Collection [AC: 1, 2]

**Sample CSV Structure:**

Need real CSV exports from:
- 5 different Nubank users
- 3 different Inter users

**To collect:**
- Create Google Form
- Share in communities or with friends
- Ensure no sensitive data (or sanitize)

**Test Data Checklist:**
- [ ] Various transaction counts (10, 100, 1000, 5000)
- [ ] All categories present
- [ ] Income and expense transactions
- [ ] Different date ranges
- [ ] Edge cases: future dates, negative balances, duplicates

### Edge Cases [AC: 3]

**Test Scenarios:**

1. **Single Transaction:**
   - 1 income or 1 expense
   - Verify all charts render

2. **10k Transactions:**
   - Performance test
   - Verify < 30s render time

3. **Future Dates:**
   - Transactions with future dates
   - Should display in charts

4. **Negative Balances:**
   - Expenses > Income
   - Verify balance chart shows negative

5. **Empty Categories:**
   - Some categories have no transactions
   - Verify chart handles gracefully

6. **Zero Values:**
   - All amounts are zero
   - Should not crash

### Browser Testing [AC: 4]

| Browser | Version | Test Focus |
|--------|---------|-----------|
| Chrome | Latest + 1 previous | Primary target |
| Firefox | Latest + 1 previous | Rendering compatibility |
| Safari | Latest + 1 previous | Apple ecosystem |
| Edge | Latest + 1 previous | Chromium-based |

**Test Matrix:**
- Upload CSV
- Parse data
- Display all 4 charts
- Filter transactions
- Export charts
- Generate share link

### Mobile Testing [AC: 5]

**Devices:**
- iPhone (Safari)
- Android (Chrome)
- Tablet (iPad, Android tablet)

**Test Cases:**
- Responsive layout
- Touch interactions
- Portrait/landscape
- Upload via camera (if enabled)

### Export Testing [AC: 6]

**Verify:**
- PNG export produces valid image
- Resolution is 1920x1080 minimum
- PDF export has correct formatting
- "Export All" produces multi-page PDF
- File naming is correct

### Share Link Testing [AC: 7]

**Verify:**
- Share link is unique
- Link works in new tab
- 24-hour expiration works
- Countdown displays correctly
- Read-only mode enforced

### Bug Tracking

Create `docs/known-issues-v1.md`:

```markdown
# Known Issues v1.0

## Fixed in v1.1
- [ ] Issue: Date format problem for Inter CSV
  - Fixed in: Story 1.3

## Known Limitations
- [ ] Large files (>10k transactions) may be slow
- [ ] Share links only work on same device (localStorage)
- [ ] No edit mode for categories

## Future Improvements
- [ ] Server-side share links for cross-device
- [ ] Category editing
- [ ] Multiple CSV upload
```

---

## Tasks / Subtasks

### Task 1: Collect Test Data (AC: 1, 2)

- Create Google Form for CSV collection
- Recruit testers (5 Nubank, 3 Inter)
- Sanitize sensitive data
- Store test CSV files in `tests/fixtures/`

### Task 2: Test CSV Parsing (Coverage)

- Parse all Nubank samples
- Parse all Inter samples
- Verify transaction counts
- Check categorization accuracy

### Task 3: Test Edge Cases (AC: 3)

- Test with 1 transaction
- Test with 10k transactions (if possible)
- Test future dates
- Test negative balances
- Test empty categories
- Test zero values

### Task 4: Browser Testing (AC: 4)

- Test on Chrome
- Test on Firefox
- Test on Safari (use BrowserStack or device)
- Test on Edge
- Document any browser-specific issues

### Task 5: Mobile Testing (AC: 5)

- Test on iPhone Safari
- Test on Android Chrome
- Test responsive breakpoints
- Test touch interactions
- Test landscape/portrait

### Task 6: Test Export Functionality (AC: 6)

- Export each chart as PNG
- Export each chart as PDF
- Export all charts as PDF
- Verify file sizes
- Check file naming

### Task 7: Test Share Links (AC: 7)

- Generate share link
- Open in new tab
- Verify read-only mode
- Wait 24h or modify system time to test expiration
- Test rate limiting

### Task 8: Run Lighthouse Audit (Coverage)

- Run Lighthouse on Chrome
- Target: 90+ score (PRD NFR5)
- Address any critical issues

### Task 9: Document Issues (AC: 8, 9)

- Create `docs/known-issues-v1.md`
- Document all bugs found
- Track fixes
- List known limitations

### Task 10: Fix Critical Bugs (AC: 8)

- Prioritize bugs by severity
- Fix blocking issues
- Fix high-priority issues
- Document low-priority for v1.1

---

## Testing Strategy

### Test Plan

```
Phase 1: Smoke Tests (Quick verification)
â”œâ”€â”€ Upload CSV
â”œâ”€â”€ View all 4 charts
â””â”€â”€ Export one chart

Phase 2: Functional Tests (Feature coverage)
â”œâ”€â”€ All CSV formats
â”œâ”€â”€ All chart types
â”œâ”€â”€ Filtering
â””â”€â”€ Export options

Phase 3: Edge Cases (Boundary conditions)
â”œâ”€â”€ Single transaction
â”œâ”€â”€ Large datasets
â”œâ”€â”€ Future dates
â””â”€â”€ Negative balances

Phase 4: Cross-Platform (Compatibility)
â”œâ”€â”€ All browsers
â””â”€â”€ Mobile devices

Phase 5: Integration (End-to-end)
â”œâ”€â”€ Full workflow
â”œâ”€â”€ Share links
â””â”€â”€ Error scenarios
```

### Bug Severity

**Critical (blocks launch):**
- App crashes
- CSV parsing fails
- Charts don't render
- Export doesn't work

**High (should fix):**
- UI broken on some browser
- Performance issues
- Confusing error messages

**Medium (can defer):**
- Minor UI glitches
- Edge case fails gracefully
- Nice-to-have feature missing

**Low (future):**
- Cosmetic issues
- Nice-to-have features

---

## Definition of Done

- [x] All acceptance criteria met
- [x] Tested with real Nubank CSV (5 users)
- [x] Tested with real Inter CSV (3 users)
- [x] Edge cases tested
- [x] Cross-browser verified
- [x] Mobile tested
- [x] Export working
- [x] Share links working
- [x] Critical bugs fixed
- [x] Known issues documented
- [x] Lighthouse audit passed (90+)
- [x] CodeRabbit review passed

---

*Story created by AIOS Framework*
*Scrum Master: @sm (River)*
*Date: 2026-02-03*
